<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Accessories Adda - Admin Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
<style>
body{background:#f8f9fa;}
.card{border-radius:10px;}
</style>
</head>
<body>
<div class="container py-4">
<h2 class="text-center text-danger mb-4">Accessories Adda - Admin Panel</h2>

<!-- Login Section -->
<div id="login-section" class="card p-4 mx-auto" style="max-width:400px;">
  <h4 class="mb-3">Admin Login</h4>
  <input id="username" class="form-control mb-2" placeholder="Username">
  <input id="password" type="password" class="form-control mb-3" placeholder="Password">
  <button class="btn btn-primary w-100" onclick="login()">Login</button>
  <div class="text-danger mt-2" id="loginError"></div>
</div>

<!-- Dashboard -->
<div id="dashboard" style="display:none;">

  <!-- Invoice Form -->
  <form id="invoiceForm" class="card p-4 shadow-lg mb-4">
    <h4 class="mb-3">Generate New Invoice</h4>
    <div class="row mb-3">
      <div class="col-md-4"><label class="form-label">Invoice No</label><input type="text" class="form-control" id="invoiceNo" readonly></div>
      <div class="col-md-4"><label class="form-label">Invoice Date</label><input type="date" class="form-control" id="invoiceDate" required></div>
      <div class="col-md-4"><label class="form-label">Customer Name</label><input type="text" class="form-control" id="customerName" required></div>
    </div>

    <!-- Bill To / Ship To -->
    <h5 class="mt-3">Bill To / Ship To</h5>
    <div class="row mb-3">
      <div class="col-md-6">
        <h6>Bill To</h6>
        <input type="text" class="form-control mb-2" id="billName" placeholder="Customer Name" required>
        <input type="text" class="form-control mb-2" id="billAddress" placeholder="Address" required>
        <input type="text" class="form-control mb-2" id="billMobile" placeholder="Mobile Number" required>
      </div>
      <div class="col-md-6">
        <h6>Ship To</h6>
        <input type="text" class="form-control mb-2" id="shipName" placeholder="Customer Name" required>
        <input type="text" class="form-control mb-2" id="shipAddress" placeholder="Address" required>
        <input type="text" class="form-control mb-2" id="shipMobile" placeholder="Mobile Number" required>
      </div>
    </div>

    <!-- Products Table -->
    <h5 class="mt-3">Products</h5>
    <table class="table table-bordered" id="productsTable">
      <thead><tr><th>Item</th><th>Qty</th><th>Price</th><th>Amount</th><th>Action</th></tr></thead>
      <tbody id="productsBody">
        <tr>
          <td><input type="text" class="form-control" name="item[]" required></td>
          <td><input type="number" class="form-control" name="qty[]" required></td>
          <td><input type="number" class="form-control" name="price[]" required></td>
          <td><input type="number" class="form-control" name="amount[]" readonly></td>
          <td><button type="button" class="btn btn-danger btn-sm removeRow">X</button></td>
        </tr>
      </tbody>
    </table>
    <button type="button" class="btn btn-success mb-3" id="addRow">+ Add Product</button>

    <div class="row mb-3">
      <div class="col-md-4"><label class="form-label">Discount (%)</label><input type="number" class="form-control" id="discount" value="0"></div>
    </div>

    <div class="mb-3">
      <label class="form-label">Terms & Conditions</label>
      <textarea class="form-control" id="terms" rows="5">
Warranty Products:
1. Standard warranty if mentioned.
2. Returns within 7 days for damaged products only.

Without Warranty Products:
1. No returns or exchanges.
2. Seller not responsible for misuse or third-party damage.
3. Prices may change without notice.
      </textarea>
    </div>

    <button type="button" class="btn btn-primary w-100" onclick="saveInvoice()">Save & Generate PDF</button>
  </form>

  <!-- Saved Invoices -->
  <h4>All Invoices</h4>
  <table class="table table-bordered bg-white">
    <thead><tr><th>#</th><th>Customer</th><th>Total</th><th>Actions</th></tr></thead>
    <tbody id="invoice-list"></tbody>
  </table>

</div>
</div>

<script>
const ADMIN_USER="admin";
const ADMIN_PASS="12345";

// Login
function login(){
  const user=document.getElementById("username").value;
  const pass=document.getElementById("password").value;
  if(user===ADMIN_USER && pass===ADMIN_PASS){
    localStorage.setItem("adminLoggedIn","true");
    showDashboard();
  } else { document.getElementById("loginError").textContent="Invalid Username or Password!"; }
}

// Show Dashboard
function showDashboard(){
  document.getElementById("login-section").style.display="none";
  document.getElementById("dashboard").style.display="block";
  autoInvoiceNo(); loadInvoices();
}

// Auto Invoice No
function autoInvoiceNo(){
  const invoices=JSON.parse(localStorage.getItem("invoices")||"[]");
  document.getElementById("invoiceNo").value=invoices.length?invoices[invoices.length-1].number+1:1;
  document.getElementById("invoiceDate").valueAsDate=new Date();
}

// Add/Remove Rows
document.getElementById("addRow").addEventListener("click",()=>{
  const row=`<tr>
    <td><input type="text" class="form-control" name="item[]" required></td>
    <td><input type="number" class="form-control" name="qty[]" required></td>
    <td><input type="number" class="form-control" name="price[]" required></td>
    <td><input type="number" class="form-control" name="amount[]" readonly></td>
    <td><button type="button" class="btn btn-danger btn-sm removeRow">X</button></td>
  </tr>`;
  document.getElementById("productsBody").insertAdjacentHTML("beforeend",row);
});
document.addEventListener("click",e=>{if(e.target.classList.contains("removeRow")) e.target.closest("tr").remove();});

// Save Invoice
function saveInvoice(){
  let rows=document.querySelectorAll("#productsBody tr"),products=[],total=0;
  rows.forEach(r=>{
    let item=r.querySelector("input[name='item[]']").value,
        qty=parseFloat(r.querySelector("input[name='qty[]']").value)||0,
        price=parseFloat(r.querySelector("input[name='price[]']").value)||0,
        amount=qty*price;
    r.querySelector("input[name='amount[]']").value=amount;
    total+=amount; products.push({item,qty,price,amount});
  });
  const discount=parseFloat(document.getElementById("discount").value)||0,
        discountAmt=total*discount/100,
        finalAmt=total-discountAmt;
  const invoice={
    number:parseInt(document.getElementById("invoiceNo").value),
    date:document.getElementById("invoiceDate").value,
    customer:{name:document.getElementById("customerName").value},
    billTo:{
      name:document.getElementById("billName").value,
      address:document.getElementById("billAddress").value,
      mobile:document.getElementById("billMobile").value
    },
    shipTo:{
      name:document.getElementById("shipName").value,
      address:document.getElementById("shipAddress").value,
      mobile:document.getElementById("shipMobile").value
    },
    products,discount,discountAmt,total,finalAmt,
    terms:document.getElementById("terms").value
  };
  let invoices=JSON.parse(localStorage.getItem("invoices")||"[]"); invoices.push(invoice);
  localStorage.setItem("invoices",JSON.stringify(invoices));
  generatePDF(invoice); loadInvoices(); autoInvoiceNo();
}

// Load Invoices
function loadInvoices(){
  const invoices=JSON.parse(localStorage.getItem("invoices")||"[]");
  const tbody=document.getElementById("invoice-list"); tbody.innerHTML="";
  invoices.forEach(inv=>{
    const row=`<tr>
      <td>${inv.number}</td>
      <td>${inv.customer.name}</td>
      <td>${inv.finalAmt.toFixed(2)}</td>
      <td>
        <button class="btn btn-sm btn-info" onclick='generatePDF(${JSON.stringify(inv)})'>PDF</button>
        <button class="btn btn-sm btn-danger" onclick='deleteInvoice(${inv.number})'>Delete</button>
      </td>
    </tr>`;
    tbody.innerHTML+=row;
  });
}

// Delete Invoice
function deleteInvoice(number){
  if(!confirm("Delete this invoice?")) return;
  let invoices=JSON.parse(localStorage.getItem("invoices")||"[]");
  invoices=invoices.filter(inv=>inv.number!==number);
  localStorage.setItem("invoices",JSON.stringify(invoices));
  loadInvoices();
}

// Generate Professional PDF
function generatePDF(inv){
  const { jsPDF }=window.jspdf;
  const doc=new jsPDF("p","mm","a4"); const pageWidth=doc.internal.pageSize.getWidth();
  doc.setFontSize(20); doc.setTextColor(0,51,102); doc.text("Accessories Adda",14,20);
  doc.setFontSize(10); doc.setTextColor(0); doc.text("Indore, Madhya Pradesh",14,27); doc.text("Phone: +91 9770274616",14,33);
  doc.setFontSize(12); doc.text(`Invoice No: ${inv.number}`,pageWidth-14,27,{align:"right"}); doc.text(`Date: ${inv.date}`,pageWidth-14,33,{align:"right"});
  doc.setFontSize(11); doc.text("Bill To:",14,45); doc.text(`Name: ${inv.billTo.name}`,14,50); doc.text(`Address: ${inv.billTo.address}`,14,55); doc.text(`Mobile: ${inv.billTo.mobile}`,14,60);
  doc.text("Ship To:",pageWidth/2+10,45); doc.text(`Name: ${inv.shipTo.name}`,pageWidth/2+10,50); doc.text(`Address: ${inv.shipTo.address}`,pageWidth/2+10,55); doc.text(`Mobile: ${inv.shipTo.mobile}`,pageWidth/2+10,60);
  let productData=inv.products.map(p=>[p.item,p.qty,p.price.toFixed(2),p.amount.toFixed(2)]);
  doc.autoTable({startY:70,head:[['Item','Qty','Price','Amount']],body:productData,theme:'grid',headStyles:{fillColor:[0,51,102],textColor:255},styles:{fontSize:10},columnStyles:{0:{cellWidth:90},1:{cellWidth:20,halign:'center'},2:{cellWidth:35,halign:'right'},3:{cellWidth:35,halign:'right'}}});
  const finalY=doc.lastAutoTable.finalY+5; doc.setFontSize(11); doc.text(`Total: ₹${inv.total.toFixed(2)}`,pageWidth-14,finalY,{align:'right'});
  doc.text(`Discount: ${inv.discount}%`,pageWidth-14,finalY+6,{align:'right'}); doc.text(`Discount Amount: ₹${inv.discountAmt.toFixed(2)}`,pageWidth-14,finalY+12,{align:'right'}); doc.text(`Final Amount: ₹${inv.finalAmt.toFixed(2)}`,pageWidth-14,finalY+18,{align:'right'});
  doc.setFontSize(10); doc.text("Terms & Conditions:",14,finalY+28); let lines=doc.splitTextToSize(inv.terms,pageWidth-28); doc.text(lines,14,finalY+34);
  doc.setFontSize(9); doc.setTextColor(100); doc.text("This is a computer-generated invoice and does not require a signature.",14,290);
  doc.save(`Invoice_${inv.number}.pdf`);
}

// Auto-show if logged in
if(localStorage.getItem("adminLoggedIn")==="true") showDashboard();
</script>
</body>
</html>
